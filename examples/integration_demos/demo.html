<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PACT Learning Experience Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .demo-controls {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .student-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .student-card {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .student-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .student-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .student-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .student-details {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .learning-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            min-height: 400px;
        }
        
        .lesson-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f1f1;
        }
        
        .lesson-title {
            font-size: 1.8em;
            color: #2c3e50;
        }
        
        .engagement-indicator {
            display: flex;
            align-items: center;
            background: #e8f4f8;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }
        
        .engagement-bar {
            width: 60px;
            height: 6px;
            background: #ddd;
            border-radius: 3px;
            margin: 0 10px;
            overflow: hidden;
        }
        
        .engagement-fill {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c 0%, #f39c12 50%, #27ae60 100%);
            transition: width 0.5s ease;
            width: 50%;
        }
        
        .lesson-content {
            line-height: 1.6;
            font-size: 1.1em;
        }
        
        .lesson-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .interactive-element {
            background: white;
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .interactive-element:hover {
            background: #f0f4ff;
            transform: scale(1.02);
        }
        
        .quiz-question {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .quiz-options {
            display: grid;
            gap: 10px;
            margin-top: 15px;
        }
        
        .quiz-option {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            padding: 12px 15px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .quiz-option:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .quiz-option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }
        
        .metrics-panel {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }
        
        .metric-card {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-top: 4px solid #667eea;
        }
        
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .metric-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        .adaptation-log {
            background: #2c3e50;
            color: white;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .adaptation-entry {
            padding: 5px 0;
            border-bottom: 1px solid #34495e;
        }
        
        .adaptation-entry:last-child {
            border-bottom: none;
        }
        
        .timestamp {
            color: #95a5a6;
            margin-right: 10px;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-danger {
            background: #e74c3c;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #27ae60;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }
        
        .notification.warning {
            background: #f39c12;
        }
        
        .notification.error {
            background: #e74c3c;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .student-selector {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŽ“ PACT Learning Experience Demo</h1>
            <p>Real-time adaptive education with engagement tracking</p>
        </div>
        
        <div class="demo-controls">
            <h2>Select Your Student Profile</h2>
            <div class="student-selector" id="studentSelector">
                <!-- Students will be populated by JavaScript -->
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" onclick="startLearningExperience()">
                    <span id="startBtnText">Start Learning Experience</span>
                    <span id="startBtnLoader" class="loading hidden"></span>
                </button>
                <button class="btn btn-secondary" onclick="simulateConfusion()">Simulate Confusion</button>
                <button class="btn btn-danger" onclick="simulateEngagementDrop()">Simulate Low Engagement</button>
            </div>
        </div>
        
        <div class="learning-content" id="learningContent">
            <div class="lesson-header">
                <h2 class="lesson-title" id="lessonTitle">Select a student to begin</h2>
                <div class="engagement-indicator">
                    <span>Engagement:</span>
                    <div class="engagement-bar">
                        <div class="engagement-fill" id="engagementFill"></div>
                    </div>
                    <span id="engagementPercent">50%</span>
                </div>
            </div>
            
            <div id="lessonContent">
                <p style="text-align: center; color: #7f8c8d; font-size: 1.2em; margin-top: 100px;">
                    Choose a student profile above to start your personalized learning experience
                </p>
            </div>
        </div>
        
        <div class="metrics-panel">
            <h2>Real-time Analytics</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value" id="timeOnPage">0s</div>
                    <div class="metric-label">Time on Page</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="interactions">0</div>
                    <div class="metric-label">Interactions</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="focusTime">0s</div>
                    <div class="metric-label">Focus Time</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="adaptations">0</div>
                    <div class="metric-label">Adaptations</div>
                </div>
            </div>
            
            <div class="adaptation-log" id="adaptationLog">
                <div style="text-align: center; color: #95a5a6;">Waiting for adaptation events...</div>
            </div>
        </div>
    </div>

    <!-- Include the engagement tracker -->
    <script src="engagement_tracker.js"></script>
    
    <script>
        // Demo configuration
        const DEMO_CONFIG = {
            apiEndpoint: 'http://localhost:8000',
            websocketEndpoint: 'ws://localhost:8000',
            debugMode: true
        };
        
        // Sample student profiles
        const STUDENT_PROFILES = [
            {
                id: 'student_001',
                name: 'Alex Chen',
                grade: '5th Grade',
                style: 'Visual Learner',
                avatar: 'ðŸ‘¦',
                preferences: {
                    learning_style: 'visual',
                    difficulty_preference: 'medium',
                    knowledge_level: 0.6
                }
            },
            {
                id: 'student_002',
                name: 'Maya Patel',
                grade: '4th Grade',
                style: 'Kinesthetic Learner',
                avatar: 'ðŸ‘§',
                preferences: {
                    learning_style: 'kinesthetic',
                    difficulty_preference: 'easy',
                    knowledge_level: 0.4
                }
            },
            {
                id: 'student_003',
                name: 'Jordan Smith',
                grade: '5th Grade',
                style: 'Auditory Learner',
                avatar: 'ðŸ§‘',
                preferences: {
                    learning_style: 'auditory',
                    difficulty_preference: 'hard',
                    knowledge_level: 0.8
                }
            },
            {
                id: 'student_004',
                name: 'Emma Rodriguez',
                grade: '3rd Grade',
                style: 'Reading Learner',
                avatar: 'ðŸ‘©',
                preferences: {
                    learning_style: 'reading',
                    difficulty_preference: 'medium',
                    knowledge_level: 0.5
                }
            }
        ];
        
        // Global state
        let selectedStudent = null;
        let currentExperience = null;
        let pactTracker = null;
        let adaptationCount = 0;
        
        // Initialize demo
        function initDemo() {
            renderStudentSelector();
            updateMetrics();
        }
        
        function renderStudentSelector() {
            const selector = document.getElementById('studentSelector');
            selector.innerHTML = STUDENT_PROFILES.map(student => `
                <div class="student-card" data-student-id="${student.id}" onclick="selectStudent('${student.id}')">
                    <div class="student-name">${student.avatar} ${student.name}</div>
                    <div class="student-details">
                        ${student.grade} â€¢ ${student.style}
                    </div>
                </div>
            `).join('');
        }
        
        function selectStudent(studentId) {
            // Update UI
            document.querySelectorAll('.student-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`[data-student-id="${studentId}"]`).classList.add('selected');
            
            // Set selected student
            selectedStudent = STUDENT_PROFILES.find(s => s.id === studentId);
            
            // Update lesson title
            document.getElementById('lessonTitle').textContent = 
                `Welcome ${selectedStudent.name}! Ready to learn about Fractions?`;
            
            showNotification(`Selected ${selectedStudent.name}`, 'success');
        }
        
        async function startLearningExperience() {
            if (!selectedStudent) {
                showNotification('Please select a student first!', 'warning');
                return;
            }
            
            // Show loading
            document.getElementById('startBtnText').classList.add('hidden');
            document.getElementById('startBtnLoader').classList.remove('hidden');
            
            try {
                // Initialize engagement tracker
                if (pactTracker) {
                    pactTracker.stop();
                }
                
                pactTracker = new PACTEngagementTracker({
                    ...DEMO_CONFIG,
                    studentId: selectedStudent.id,
                    sessionId: 'demo_session_' + Date.now()
                });
                
                // Generate experience via API
                const experience = await generateExperience();
                
                if (experience) {
                    currentExperience = experience;
                    pactTracker.setExperienceId(experience.experience_id);
                    renderLearningContent(experience);
                    showNotification('Learning experience started!', 'success');
                    
                    // Start metrics updates
                    setInterval(updateMetrics, 2000);
                } else {
                    throw new Error('Failed to generate experience');
                }
            } catch (error) {
                console.error('Error starting experience:', error);
                showNotification('Failed to start experience. Make sure the API is running!', 'error');
            } finally {
                // Hide loading
                document.getElementById('startBtnText').classList.remove('hidden');
                document.getElementById('startBtnLoader').classList.add('hidden');
            }
        }
        
        async function generateExperience() {
            const response = await fetch(`${DEMO_CONFIG.apiEndpoint}/generate`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    context: {
                        student_id: selectedStudent.id,
                        session_id: 'demo_session_' + Date.now(),
                        subject: 'Mathematics',
                        grade_level: selectedStudent.grade,
                        learning_style: selectedStudent.preferences.learning_style,
                        difficulty_preference: selectedStudent.preferences.difficulty_preference,
                        interests: ['games', 'puzzles'],
                        current_knowledge_level: selectedStudent.preferences.knowledge_level,
                        engagement_score: 0.5,
                        attention_span: 15
                    },
                    content_type: 'lesson',
                    topic: 'Fractions',
                    duration_minutes: 15,
                    adaptation_enabled: true,
                    real_time_feedback: true
                })
            });
            
            if (response.ok) {
                return await response.json();
            }
            return null;
        }
        
        function renderLearningContent(experience) {
            const content = experience.content;
            const lessonContent = document.getElementById('lessonContent');
            
            let html = `
                <div class="lesson-section">
                    <h3>${content.title}</h3>
                    <p><strong>Learning Objectives:</strong></p>
                    <ul>
                        ${content.learning_objectives.map(obj => `<li>${obj}</li>`).join('')}
                    </ul>
                </div>
            `;
            
            // Add sections if available
            if (content.sections) {
                content.sections.forEach(section => {
                    html += `
                        <div class="lesson-section">
                            <h4>${section.title}</h4>
                            <p>${section.content}</p>
                            <small><strong>Duration:</strong> ${section.duration} minutes | <strong>Difficulty:</strong> ${section.difficulty}</small>
                        </div>
                    `;
                });
            }
            
            // Add interactive elements based on learning style
            if (content.visual_elements) {
                html += `
                    <div class="interactive-element" onclick="interactWithElement('visual')">
                        ðŸŽ¨ <strong>Visual Activity:</strong> Interactive fraction diagrams and visual representations
                        <br><small>Click to explore visual learning materials</small>
                    </div>
                `;
            }
            
            if (content.interactive_elements) {
                html += `
                    <div class="interactive-element" onclick="interactWithElement('kinesthetic')">
                        ðŸŽ® <strong>Hands-on Activity:</strong> Drag and drop fraction pieces
                        <br><small>Click to start interactive fraction building</small>
                    </div>
                `;
            }
            
            if (content.audio_elements) {
                html += `
                    <div class="interactive-element" onclick="interactWithElement('audio')">
                        ðŸ”Š <strong>Audio Lesson:</strong> Listen to fraction explanations with examples
                        <br><small>Click to play audio content</small>
                    </div>
                `;
            }
            
            // Add knowledge checks
            if (content.knowledge_checks) {
                content.knowledge_checks.forEach((check, index) => {
                    if (check.type === 'multiple_choice') {
                        html += `
                            <div class="quiz-question">
                                <h4>Quick Check: ${check.question}</h4>
                                <div class="quiz-options">
                                    <div class="quiz-option" onclick="selectQuizOption(this, 'A')">A) 1/4</div>
                                    <div class="quiz-option" onclick="selectQuizOption(this, 'B')">B) 1/2</div>
                                    <div class="quiz-option" onclick="selectQuizOption(this, 'C')">C) 3/4</div>
                                    <div class="quiz-option" onclick="selectQuizOption(this, 'D')">D) 1/3</div>
                                </div>
                            </div>
                        `;
                    }
                });
            }
            
            lessonContent.innerHTML = html;
        }
        
        function interactWithElement(type) {
            showNotification(`Interacting with ${type} element!`, 'success');
            
            // Simulate positive engagement
            if (pactTracker) {
                // This will be tracked automatically by the engagement tracker
                console.log(`${type} interaction recorded`);
            }
        }
        
        function selectQuizOption(element, option) {
            // Remove previous selections
            element.parentNode.querySelectorAll('.quiz-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Select current option
            element.classList.add('selected');
            
            showNotification(`Selected option ${option}`, 'success');
        }
        
        function simulateConfusion() {
            if (pactTracker && currentExperience) {
                pactTracker.triggerManualAdaptation('confusion_detected', 0.9);
                showNotification('Simulated confusion - triggering adaptation', 'warning');
                logAdaptation('Manual trigger: confusion_detected');
            } else {
                showNotification('Start a learning experience first!', 'warning');
            }
        }
        
        function simulateEngagementDrop() {
            if (pactTracker && currentExperience) {
                pactTracker.triggerManualAdaptation('engagement_drop', 0.8);
                showNotification('Simulated engagement drop - triggering adaptation', 'warning');
                logAdaptation('Manual trigger: engagement_drop');
            } else {
                showNotification('Start a learning experience first!', 'warning');
            }
        }
        
        function updateMetrics() {
            if (!pactTracker) return;
            
            const metrics = pactTracker.getMetrics();
            const summary = pactTracker.getEngagementSummary();
            
            // Update metric displays
            document.getElementById('timeOnPage').textContent = summary.time_on_page;
            document.getElementById('interactions').textContent = summary.interactions;
            document.getElementById('focusTime').textContent = summary.focus_time;
            document.getElementById('adaptations').textContent = adaptationCount;
            
            // Update engagement bar
            const engagementPercent = Math.round(metrics.engagementLevel * 100);
            document.getElementById('engagementFill').style.width = engagementPercent + '%';
            document.getElementById('engagementPercent').textContent = engagementPercent + '%';
        }
        
        function logAdaptation(message) {
            const log = document.getElementById('adaptationLog');
            const timestamp = new Date().toLocaleTimeString();
            
            const entry = document.createElement('div');
            entry.className = 'adaptation-entry';
            entry.innerHTML = `<span class="timestamp">${timestamp}</span>${message}`;
            
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
            
            adaptationCount++;
        }
        
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // Initialize demo when page loads
        document.addEventListener('DOMContentLoaded', initDemo);
        
        // Handle page visibility changes
        document.addEventListener('visibilitychange', () => {
            if (pactTracker) {
                console.log('Page visibility changed:', document.hidden ? 'hidden' : 'visible');
            }
        });
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (pactTracker) {
                pactTracker.stop();
            }
        });
    </script>
</body>
</html>
